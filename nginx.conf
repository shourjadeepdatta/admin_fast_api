# For more information on configuration, see:
#   * Official English Documentation: http://nginx.org/en/docs/
#   * Official Russian Documentation: http://nginx.org/ru/docs/

user root;
worker_processes auto;
error_log /var/log/nginx/error.log;
pid /run/nginx.pid;

# Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.
include /usr/share/nginx/modules/*.conf;

events {
    worker_connections 1024;

}
http {
    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  /var/log/nginx/access.log  main;

    sendfile            on;
    tcp_nopush          on;
    tcp_nodelay         on;
    keepalive_timeout   65;
    types_hash_max_size 4096;

    include             /etc/nginx/mime.types;
    default_type        application/octet-stream;

    # Load modular configuration files from the /etc/nginx/conf.d directory.
    # See http://nginx.org/en/docs/ngx_core_module.html#include
    # for more information.
    include /etc/nginx/conf.d/*.conf;

   server {
   	server_name vcipuat.rblbank.com;
	listen 5560;
	listen [::]:5560;

	if ($request_method !~ ^(GET|HEAD|POST)$) { return 405;}

   	location /health {
		add_header Content-Type text/plain;
		return 200 "5560 ok";
	}

	location /{
	        root /home/vcip-user/Kwikid_ipv_poc/ipv-portal/build/;
		        try_files /index.html =404;
	}

   }



    server{
       server_name vcipuat.rblbank.com;
        listen 443;
        listen [::]:443;
        client_max_body_size 100M;
	client_header_buffer_size 1k;
	large_client_header_buffers 2 1k;
        error_page 497 301 =307 https://$host:$server_port$request_uri;

	#Security-----------------------------------------------------
	#add_header X-XSS-Protection "1;mode=block";
	#add_header X-Frame-Options "SAMEORIGIN";
	
	#Block download agents?
	if ($http_user_agent ~* LWP::Simple|wget|libwww-perl) {return 403;}
	if ($http_user_agent ~ (msnbot|Purebot|Baiduspider|Lipperhey|Mail.Ru|scrapbot)) {return 403;}

	if ($http_referrer ~* (babes|forsale|girl|jewellery|love|nude|organic|poker|porn|sex|teen)) {return 403;}

	server_tokens off;
	if ($request_method !~ ^(GET|HEAD|POST)$) { return 405;}


location /agent/staticFiles/ {
        root /home/vcip-user/Kwikid_ipv_poc/ipv-portal/build/;
        try_files $uri /$uri;
}


location /api/v1/config/ {
                proxy_pass http://localhost:5558/config/;
                proxy_pass_request_headers on;
        }
location /api/maps/ {
                proxy_pass http://dev.vkyc.getkwikid.com:3650/api/maps/;
                proxy_pass_request_headers on;
        }

location /api/v1/sendLogs {
rewrite ^/api/v1/sendLogs/(.*) /$1 break;
proxy_pass https://uat.vkyc.getkwikid.com:4545/sendLogs;
}

location /health {
        add_header Content-Type text/plain;
        return 200 "ok";
}

location /v1/health {
        add_header Content-Type text/plain;
	        return 200 "ok";
		}


location /CONFIG/ {
        proxy_pass https://kwikid.s3.ap-south-1.amazonaws.com/CONFIG/ ;
        proxy_pass_request_headers on;
}

location /ocr/{
        proxy_pass https://kbipvd.thinkanalytics.in:6356/;
        proxy_pass_request_headers on;
}


location /xmlurl/ {
        proxy_pass_request_headers on;
        proxy_pass http://localhost:5557/v1/;
}

location /api/v1/user {
	rewrite ^/api/(.*) /$1 break;
        proxy_pass_request_headers on;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_pass http://localhost:5555;
        }

location /api/v1/scheduling/v1/schedule/ {
        proxy_pass_request_headers on;
        proxy_pass http://localhost:5559/;
        }

location /api/v1/scheduling/ {
        proxy_pass_request_headers on;
        proxy_pass http://localhost:5559/;
        }
location /api/v3/ {
        proxy_pass_request_headers on;
        proxy_pass http://localhost:5558/;
}

location /api/v1/v1/ {
        #rewrite ^/api/(.*) /$1 break;
        proxy_pass_request_headers on;
        proxy_pass http://localhost:5557/v1/;
        }

location /api/v1/ {
	rewrite ^/api/(.*) /$1 break;
        proxy_pass_request_headers on;
        proxy_pass http://localhost:5557/;
        }
location /api/agent/ {
        #rewrite ^/api/(.*) /$1 break;
        proxy_pass_request_headers on;
        proxy_pass http://localhost:5557/v1/agent/;
        }
location /sessionid/socket.io/ {
        #proxy_pass https://faceailive.thinkanalytics.in;
        proxy_pass http://localhost:3004/socket.io/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        }
location /api/v2/ {
	rewrite ^/api/(.*) /$1 break;
        proxy_pass http://localhost:5557;
        proxy_pass_request_headers on;
        }

location /ap1/v1/sendlogs {
        proxy_pass https://uat.vkyc.getkwikid.com:4545/sendlogs;
        proxy_pass_request_headers on;
}


location /static/media/circle_check_false.f0e742e7.svg {
	root /home/vcip-user/Kwikid_ipv_poc/ipv-portal/build/;
}

location /static/media/circle_check_true.d126b8f5.svg {
	        root /home/vcip-user/Kwikid_ipv_poc/ipv-portal/build/;
}

location /static/media/comment_icon.ea61c4d2.svg {
	        root /home/vcip-user/Kwikid_ipv_poc/ipv-portal/build/;
}




location /static/ {
        if ($http_referer ~ ^https?://vcipuat.rblbank.com/agent ) {


                root /home/vcip-user/Kwikid_ipv_poc/ipv-portal/build;
        }

        if ($http_referer ~ ^https?://vcipuat.rblbank.com/active ) {
                root /home/vcip-user/Kwikid_ipv_poc/ipv-portal/build;

        }

        if ($http_referer ~ ^https?://vcipuat.rblbank.com/admin ) {

                root /home/vcip-user/Kwikid_ipv_poc/admin-portal-frontend/build/;
        }

        if ($http_referer ~ ^https?://vcipuat.rblbank.com/user ) {
              root /home/vcip-user/Kwikid_ipv_poc/poc-app/www/;
        }

        if ($http_referer ~ ^https?://vcipuat.rblbank.com/concurrent ) {
              root /home/vcip-user/Kwikid_ipv_poc/ipv-portal/build/;
        }

        if ($http_referer ~ ^https?://vcipuat.rblbank.com/dashboard ) {
                        root /home/vcip-user/Kwikid_ipv_poc/ipv-portal/build/;
        }

        if ($http_referer ~ ^https?://vcipuat.rblbank.com/live) {
              root /home/vcip-user/Kwikid_ipv_poc/admin-portal-frontend/build/;
        }

        if ($http_referer ~ ^https?://vcipuat.rblbank.com/static/css/main.6a45198e.chunk.css ) {
               root /home/vcip-user/Kwikid_ipv_poc/ipv-portal/build/;
        }

        if ($http_referer ~ ^https?://vcipuat.rblbank.com/static/css/3.36f27d7a.chunk.css ) {
               root /home/vcip-user/Kwikid_ipv_poc/ipv-portal/build/;
        }

        if ($http_referer ~ ^https?://vcipuat.rblbank.com/static/css/main.eeab2909.chunk.css ) {
               root /home/vcip-user/Kwikid_ipv_poc/admin-portal-frontend/build/;
        }

        if ($http_referer ~ ^https?://vcipuat.rblbank.com/static/css/main.8f2a03e2.chunk.css ) {
               root /home/vcip-user/Kwikid_ipv_poc/admin-portal-frontend/build/;
        }

        if ($http_referer ~ ^https?://vcipuat.rblbank.com/static/css/2.53656d99.chunk.css ) {
               root /home/vcip-user/Kwikid_ipv_poc/admin-portal-frontend/build/;
        }

        if ($http_referer ~ ^https?://vcipuat.rblbank.com/static/css/2.53656d99.chunk.css ) {
               root /home/vcip-user/Kwikid_ipv_poc/admin-portal-frontend/build/;
        }
        if ($http_referer ~ ^https?://vcipuat.rblbank.com/static/css/main.a80c392f.chunk.css ) {
               root /home/vcip-user/Kwikid_ipv_poc/ipv-portal/build/;
        }
        if ($http_referer ~ ^https?://vcipuat.rblbank.com/static/css/3.87e8430e.chunk.css ) {
               root /home/vcip-user/Kwikid_ipv_poc/ipv-portal/build/;
        }
        if ($http_referer ~ ^https?://vcipuat.rblbank.com/static/css/main.6ed6f9e7.chunk.css ) {
               root /home/vcip-user/Kwikid_ipv_poc/ipv-portal/build/;
        }


        try_files $uri /$uri;

}

location /agent/dashboard {
        return 302 https://vcipuat.rblbank.com/agent;
        #root /home/vcip-user/Kwikid_ipv_poc/ipv-portal/build/;
        #try_files /index.html =404;

}

location /agent {
        root /home/vcip-user/Kwikid_ipv_poc/ipv-portal/build/;
        try_files /index.html =404;

}

location /login  {
        root /home/vcip-user/Kwikid_ipv_poc/poc-app/www/;
        try_files /index.html =404;

}
location /user {
        root /home/vcip-user/Kwikid_ipv_poc/poc-app/www/;
        try_files /index.html =404;

}
location /xml-page {
        root /home/vcip-user/Kwikid_ipv_poc/poc-app/www;
        try_files /index.html =404;

}


location /admin {

                root /home/vcip-user/Kwikid_ipv_poc/admin-portal-frontend/build/;
        try_files /index.html =404;
}

location /sessions {

                root /home/vcip-user/Kwikid_ipv_poc/admin-portal-frontend/build/;
        try_files /index.html =404;
}

location /live {

                root /home/vcip-user/Kwikid_ipv_poc/admin-portal-frontend/build/;
        try_files /index.html =404;
}


location /dashboard {

                root /home/vcip-user/Kwikid_ipv_poc/ipv-portal/build/;
        try_files /index.html =404;
}

location /concurrent {
                root /home/vcip-user/Kwikid_ipv_poc/ipv-portal/build/;
        try_files /index.html =404;
}

location /active {
                root /home/vcip-user/Kwikid_ipv_poc/ipv-portal/build/;
        try_files /index.html =404;
}


location /instructions {
        root /home/vcip-user/Kwikid_ipv_poc/poc-app/www/;
        try_files /index.html =404;

}

location /process {
        root /home/vcip-user/Kwikid_ipv_poc/poc-app/www/;
        try_files /index.html =404;
}

location / {
        if ($http_referer ~ ^https?://vcipuat.rblbank.com/agent ) {
               root /home/vcip-user/Kwikid_ipv_poc/ipv-portal/build/;
                #try_files $uri /$uri;
        }

        if ($http_referer ~ ^https?://vcipuat.rblbank.com/admin ) {
         #       #return 200 'hi form admin referer';
               root /home/vcip-user/Kwikid_ipv_poc/admin-portal-frontend/build/;
                #try_files $uri /$uri;
        }

        if ($http_referer ~ ^https?://vcipuat.rblbank.com/user ) {
         #       #return 200 'hi form admin referer';
              root /home/vcip-user/Kwikid_ipv_poc/poc-app/www/;
                #try_files $uri /$uri;
        }

        if ($http_referer ~ ^https?://vcipuat.rblbank.com/concurrent ) {
         #       #return 200 'hi form admin referer';
              root /home/vcip-user/Kwikid_ipv_poc/ipv-portal/build/;
                #try_files $uri /$uri;
        }

        if ($http_referer ~ ^https?://vcipuat.rblbank.com/dashboard ) {
         #       #return 200 'hi form admin referer';
              root /home/vcip-user/Kwikid_ipv_poc/ipv-portal/build/;
                #try_files $uri /$uri;
        }

        if ($http_referer ~ ^https?://vcipuat.rblbank.com/live) {
         #       #return 200 'hi form admin referer';
              root /home/vcip-user/Kwikid_ipv_poc/admin-portal-frontend/build/;
                #try_files $uri /$uri;
        }

        if ($http_referer ~ ^https?://vcipuat.rblbank.com/instructions) {
         #       #return 200 'hi form admin referer';
              root /home/vcip-user/Kwikid_ipv_poc/poc-app/www/;
                #try_files $uri /$uri;
        }
        if ($http_referer ~ ^https?://vcipuat.rblbank.com/) {
         #       #return 200 'hi form admin referer';
              root /home/vcip-user/Kwikid_ipv_poc/poc-app/www/;
                #try_files $uri /$uri;
        }

        if ($http_referer ~ ^https?://vcipuat.rblbank.com/waiting) {
         #       #return 200 'hi form admin referer';
              root /home/vcip-user/Kwikid_ipv_poc/poc-app/www/;
                #try_files $uri /$uri;
        }


        if ($http_referer ~ ^https?://vcipuat.rblbank.com/process) {
         #       #return 200 'hi form admin referer';
              root /home/vcip-user/Kwikid_ipv_poc/poc-app/www/;
                #try_files $uri /$uri;
        }

        if ($http_referer ~ ^https?://vcipuat.rblbank.com/result) {
         #       #return 200 'hi form admin referer';
              root /home/vcip-user/Kwikid_ipv_poc/poc-app/www/;
                #try_files $uri /$uri;
        }

        if ($http_referer ~ ^https?://vcipuat.rblbank.com/admin/) {
         #       #return 200 'hi form admin referer';
              root /home/vcip-user/Kwikid_ipv_poc/admin-portal-frontend/build/;
                #try_files $uri /$uri;
        }

        if ($http_referer ~ ^https?://vcipuat.rblbank.com/sessions) {
         #       #return 200 'hi form admin referer';
              root /home/vcip-user/Kwikid_ipv_poc/admin-portal-frontend/build/;
                #try_files $uri /$uri;
        }

        try_files $uri /$uri;

}


}
}

